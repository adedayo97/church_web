{% extends 'codesign/elements/layouts/layout.html' %}
{% load static %}

{% block additional_css %}
    <style>
        .dzFormMsg { margin-top: 10px; text-align: center; }
        .dzFormMsg .success { background-color: #d4edda; color: #155724; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .dzFormMsg .error { background-color: #f8d7da; color: #721c24; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .btn-primary { background-color: #007bff; border: none; padding: 10px 20px; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-primary:disabled { background-color: #6c757d; cursor: not-allowed; }
        .icon-bx-wraper.style-8 { padding: 20px; border-radius: 5px; }
        .icon-bx-wraper.style-8:hover { background-color: #f8f9fa; transition: background-color 0.3s ease; }
        .visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }
    </style>
{% endblock %}

{% block content %}
    <!-- Contact Form -->
    <section class="content-inner-2 line-img">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-xl-6 col-lg-6 m-b30">
                    <form class="dz-form style-1 dzForm radius-no" id="contactForm" method="POST" action="{% url 'codesign:contact-us' %}">
                        {% csrf_token %}
                        <input type="hidden" class="form-control" name="dzToDo" value="Contact">
                        <div class="dzFormMsg">
                            {% if messages %}
                                {% for message in messages %}
                                    <p class="{{ message.tags }}">{{ message }}</p>
                                {% endfor %}
                            {% endif %}
                        </div>
                        <div class="row sp10">
                            <div class="col-sm-6 m-b20">
                                <div class="input-group">
                                    <label for="dzFirstName" class="visually-hidden">First Name</label>
                                    <input type="text" class="form-control" id="dzFirstName" name="dzFirstName" placeholder="First Name" required>
                                </div>
                            </div>
                            <div class="col-sm-6 m-b20">
                                <div class="input-group">
                                    <label for="dzLastName" class="visually-hidden">Last Name</label>
                                    <input type="text" class="form-control" id="dzLastName" name="dzLastName" placeholder="Last Name" required>
                                </div>
                            </div>
                            <div class="col-sm-6 m-b20">
                                <div class="input-group">
                                    <label for="dzEmail" class="visually-hidden">Email</label>
                                    <input type="email" class="form-control" id="dzEmail" name="dzEmail" placeholder="Email" required>
                                </div>
                            </div>
                            <div class="col-sm-6 m-b20">
                                <div class="input-group">
                                    <label for="dzPhoneNumber" class="visually-hidden">Phone Number</label>
                                    <input type="text" class="form-control" id="dzPhoneNumber" name="dzPhoneNumber" placeholder="Phone No." required>
                                </div>
                            </div>
                            <div class="col-sm-12 m-b20">
                                <div class="input-group">
                                    <label for="dzOtherSubject" class="visually-hidden">Subject</label>
                                    <input type="text" class="form-control" id="dzOtherSubject" name="dzOther[subject]" placeholder="Subject" required>
                                </div>
                            </div>
                            <div class="col-sm-12 m-b20">
                                <div class="input-group">
                                    <label for="dzMessage" class="visually-hidden">Message</label>
                                    <textarea name="dzMessage" class="form-control" id="dzMessage" placeholder="Message" required></textarea>
                                </div>
                            </div>
                            <div class="col-sm-12">
                                <button name="submit" type="submit" value="submit" class="btn btn-primary">SUBSCRIBE NOW <i class="m-l10 fas fa-caret-right"></i></button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="col-xl-6 col-lg-6">
                    <div class="row">
                        <div class="col-lg-12 m-b30">
                            <div class="icon-bx-wraper style-8 bg-white">
                                <div class="icon-md m-r20">
                                    <span class="icon-cell text-primary"><i class="flaticon-telephone"></i></span>
                                </div>
                                <div class="icon-content">
                                    <h4 class="tilte m-b10">Call Now</h4>
                                    <p class="m-b0">+773-310-3610, +773-649-9620</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 m-b30">
                            <div class="icon-bx-wraper style-8 bg-white">
                                <div class="icon-md m-r20">
                                    <span class="icon-cell text-primary"><i class="flaticon-email"></i></span>
                                </div>
                                <div class="icon-content">
                                    <h4 class="tilte m-b10">Email Now</h4>
                                    <p class="m-b0">INFO@MFMSOUTHCHICAGO.US</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 m-b30">
                            <div class="icon-bx-wraper style-8 bg-white">
                                <div class="icon-md m-r20">
                                    <span class="icon-cell text-primary"><i class="flaticon-placeholder"></i></span>
                                </div>
                                <div class="icon-content">
                                    <h4 class="tilte m-b10">Location</h4>
                                    <p class="m-b0">South Chicago Regional Headquarters, 8545 Cottage Grove Avenue, Chicago, IL 60619</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Map -->
    <section class="content-inner-1 line-img">
        <div class="container">
            <div class="section-head style-1 text-center">
                <h2 class="title">WE ARE <span class="text-primary">WORLDWIDE</span></h2>
                <div class="dz-separator style-1 text-primary"></div>
            </div>
            <img src="{% static 'codesign/images/map.png' %}" alt="Worldwide Map">
        </div>
    </section>
{% endblock %}

{% block additional_js %}
    <script>
        document.getElementById('contactForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
            const form = this;
            const submitButton = form.querySelector('button[type="submit"]');
            const msgDiv = form.querySelector('.dzFormMsg');

            // Disable button to prevent multiple submissions
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...';

            fetch(form.action, {
                method: 'POST',
                body: new FormData(form),
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (response.ok) {
                    return response.text(); // Get the redirected page HTML
                }
                throw new Error('Submission failed');
            })
            .then(() => {
                msgDiv.innerHTML = '<p class="success">Your message was sent successfully!</p>';
                form.reset();
                submitButton.textContent = 'SUBSCRIBE NOW';
                submitButton.disabled = false;
            })
            .catch(error => {
                msgDiv.innerHTML = '<p class="error">' + error.message + '</p>';
                submitButton.textContent = 'SUBSCRIBE NOW';
                submitButton.disabled = false;
            });
        });
    </script>
{% endblock %}